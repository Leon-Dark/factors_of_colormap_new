<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gaussian Perturbation Stimuli Gallery</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .gallery-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .controls {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .btn-generate {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-generate:hover {
            background-color: #0056b3;
        }

        .btn-generate:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .loading-text {
            margin-top: 10px;
            color: #666;
            font-style: italic;
            display: none;
        }

        .section-frequency {
            margin-bottom: 40px;
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
        }

        .section-header {
            padding: 15px 20px;
            color: white;
            font-size: 1.2em;
            font-weight: bold;
        }

        .header-low {
            background-color: #ff7f00;
        }

        .header-medium {
            background-color: #4daf4a;
        }

        .header-high {
            background-color: #377eb8;
        }

        .stimuli-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .stimuli-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            text-align: center;
        }

        .stimuli-card h4 {
            margin: 5px 0 10px 0;
            font-size: 14px;
            color: #555;
        }

        .canvas-pair {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 5px;
        }

        canvas {
            border: 1px solid #eee;
            background: #fff;
        }

        .labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #999;
            padding: 0 5px;
        }
    </style>
</head>

<body>
    <div class="gallery-container">
        <h1>Gaussian Perturbation Stimuli Gallery</h1>

        <div class="controls">
            <p style="margin-bottom: 15px; color: #666;">
                Stimuli Generated: 3 Frequencies × [Target Metrics] × 2 Repetitions<br>
                Each pair contains: 9 Gaussians (4 Low + 3 Mid + 2 High), with 2 Gaussians of the target frequency
                perturbed (Soft Attribution Gating ENABLED).
            </p>

            <div
                style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 20px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
                <div style="margin-bottom: 10px;">
                    <label style="font-weight: bold; margin-right: 10px;">Generation Mode:</label>
                    <select id="generation-mode" style="padding: 5px;">
                        <option value="ssim">Target SSIM</option>
                        <option value="magnitude">Fixed Magnitudes (Old)</option>
                        <option value="kl">Target KL Divergence</option>
                    </select>
                </div>

                <div id="input-group-magnitude" style="margin-bottom: 15px;">
                    <label for="magnitudes-input"
                        style="font-weight: bold; display: block; margin-bottom: 5px;">Magnitudes Input:</label>
                    <input type="text" id="magnitudes-input" value="1, 2, 3, 4, 5, 6, 7, 8, 9, 10"
                        style="width: 100%; padding: 5px; box-sizing: border-box;">
                    <p style="font-size: 11px; color: #999; margin: 2px 0;">Values 1 - 10, comma separated</p>
                </div>

                <div id="input-group-ssim" style="display: none; margin-bottom: 15px;">
                    <label style="font-weight: bold; display: block; margin-bottom: 5px;">Target SSIM Range:</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="ssim-start" value="0.995" step="0.00001" placeholder="Start"
                            style="width: 100px; padding: 5px;">
                        <span>to</span>
                        <input type="number" id="ssim-end" value="0.95" step="0.00001" placeholder="End"
                            style="width: 100px; padding: 5px;">
                        <span>step</span>
                        <input type="number" id="ssim-step" value="0.005" step="0.00001" placeholder="Step"
                            style="width: 100px; padding: 5px;">
                    </div>
                    <p style="font-size: 11px; color: #999; margin: 5px 0;">Sequence will be generated automatically
                        (e.g. 0.95, 0.90, ... 0.70)</p>
                </div>

                <div id="input-group-kl" style="display: none; margin-bottom: 15px;">
                    <label style="font-weight: bold; display: block; margin-bottom: 5px;">Target KL Divergence
                        Range:</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="kl-start" value="0.01" step="0.00001" placeholder="Start"
                            style="width: 100px; padding: 5px;">
                        <span>to</span>
                        <input type="number" id="kl-end" value="0.10" step="0.00001" placeholder="End"
                            style="width: 100px; padding: 5px;">
                        <span>step</span>
                        <input type="number" id="kl-step" value="0.02" step="0.00001" placeholder="Step"
                            style="width: 100px; padding: 5px;">
                    </div>
                    <p style="font-size: 11px; color: #999; margin: 5px 0;">Sequence will be generated automatically
                        (e.g. 0.01, 0.03, ... 0.10)</p>
                </div>
            </div>

            <!-- New: Mixing Parameters -->
            <div class="control-group"
                style="background: #fff; padding: 15px; border: 1px solid #ddd; margin: 15px auto; border-radius: 4px; max-width: 600px; text-align: left;">
                <label
                    style="display: block; font-weight: bold; margin-bottom: 15px; font-size: 14px; text-align: center;">
                    Mixing Parameters
                </label>

                <div style="display: flex; gap: 20px; justify-content: space-around; flex-wrap: wrap;">
                    <div style="display: flex; flex-direction: column; align-items: center; width: 80px;">
                        <label style="font-size: 12px; margin-bottom: 5px; color: #377eb8;">High W</label>
                        <input type="range" id="weight-high" min="1" max="3.0" value="1.0" step="0.1"
                            style="width: 100%;">
                        <input type="number" id="weight-high-value" min="1" max="3.0" value="1.0" step="0.1"
                            style="width: 60px; text-align: center; margin-top: 5px;">
                    </div>

                    <div style="display: flex; flex-direction: column; align-items: center; width: 80px;">
                        <label style="font-size: 12px; margin-bottom: 5px; color: #4daf4a;">Mid W</label>
                        <input type="range" id="weight-mid" min="1" max="5.0" value="1.5" step="0.1"
                            style="width: 100%;">
                        <input type="number" id="weight-mid-value" min="1" max="5.0" value="1.5" step="0.1"
                            style="width: 60px; text-align: center; margin-top: 5px;">
                    </div>

                    <div style="display: flex; flex-direction: column; align-items: center; width: 80px;">
                        <label style="font-size: 12px; margin-bottom: 5px; color: #ff7f00;">Low W</label>
                        <input type="range" id="weight-low" min="1" max="10.0" value="3.0" step="0.1"
                            style="width: 100%;">
                        <input type="number" id="weight-low-value" min="1" max="10.0" value="3.0" step="0.1"
                            style="width: 60px; text-align: center; margin-top: 5px;">
                    </div>

                    <div style="display: flex; flex-direction: column; align-items: center; width: 80px;">
                        <label style="font-size: 12px; margin-bottom: 5px;">Exponent</label>
                        <input type="range" id="exponent-slider" min="0.1" max="5.0" value="1.0" step="0.1"
                            style="width: 100%;">
                        <input type="number" id="exponent-slider-value" min="0.1" max="5.0" value="1.0" step="0.1"
                            style="width: 60px; text-align: center; margin-top: 5px;">
                    </div>
                </div>
            </div>
            <!-- New: Perturbation Coefficients -->
            <div class="control-group"
                style="background: #fff; padding: 15px; border: 1px solid #ddd; margin: 15px auto; border-radius: 4px; max-width: 600px; text-align: left;">
                <label
                    style="display: block; font-weight: bold; margin-bottom: 15px; font-size: 14px; text-align: center;">
                    Perturbation Coefficients
                </label>

                <div style="display: flex; gap: 20px; justify-content: space-around; flex-wrap: wrap;">
                    <div style="display: flex; flex-direction: column; align-items: center; width: 80px;">
                        <label style="font-size: 12px; margin-bottom: 5px;">Position</label>
                        <input type="range" id="coeff-position" min="0" max="2" value="0" step="0.1"
                            style="width: 100%;" disabled>
                        <span id="coeff-position-value"
                            style="font-size: 12px; font-weight: bold; color: #999;">Auto</span>
                        <span style="font-size: 9px; color: #999;">(Tanh)</span>
                    </div>

                    <div style="display: flex; flex-direction: column; align-items: center; width: 80px;">
                        <label style="font-size: 12px; margin-bottom: 5px;">Stretch</label>
                        <input type="range" id="coeff-stretch" min="0" max="2" value="0" step="0.1"
                            style="width: 100%;">
                        <span id="coeff-stretch-value" style="font-size: 12px; font-weight: bold;">0</span>
                    </div>

                    <div style="display: flex; flex-direction: column; align-items: center; width: 80px;">
                        <label style="font-size: 12px; margin-bottom: 5px;">Rotation</label>
                        <input type="range" id="coeff-rotation" min="0" max="2" value="1.0" step="0.1"
                            style="width: 100%;">
                        <span id="coeff-rotation-value" style="font-size: 12px; font-weight: bold;">1.0</span>
                    </div>

                    <div style="display: flex; flex-direction: column; align-items: center; width: 80px;">
                        <label style="font-size: 12px; margin-bottom: 5px;">Amplitude</label>
                        <input type="range" id="coeff-amplitude" min="0" max="2" value="1.0" step="0.1"
                            style="width: 100%;">
                        <span id="coeff-amplitude-value" style="font-size: 12px; font-weight: bold;">1.0</span>
                    </div>
                </div>
                <p style="font-size: 11px; color: #666; margin-top: 10px; line-height: 1.4;">
                    <strong>Note:</strong> Position uses tanh saturation to prevent out-of-bounds.
                    Rotation and Amplitude can scale freely with magnitude.
                </p>
            </div>
            <button id="btn-start" class="btn-generate">Generate All Stimuli</button>
            <div id="loading" class="loading-text">Generating... Please wait</div>
        </div>

        <div id="gallery-content">
            <!-- 动态生成的内容将被放置在这里 -->
        </div>
    </div>

    <!-- 依赖库 -->
    <script
        src="../../rainbows good or bad for/supplementary materials/experiment interface/jnd/lib/d3.min.js"></script>
    <script src="../../rainbows good or bad for/supplementary materials/experiment interface/src/scalar.js"></script>
    <script
        src="../../rainbows good or bad for/supplementary materials/experiment interface/lineup/gaussmix.js"></script>
    <script
        src="../../rainbows good or bad for/supplementary materials/experiment interface/lineup/gaussmix_bivariate.js"></script>
    <script
        src="../../rainbows good or bad for/supplementary materials/experiment interface/lineup/gauss_w_noise.js"></script>
    <script
        src="../../rainbows good or bad for/supplementary materials/experiment interface/lineup/scalar_sample.js"></script>

    <!-- 我们的模块 -->
    <script src="js/utils.js"></script>
    <script src="js/colormaps_presets.js"></script>
    <script src="js/visualization.js"></script>
    <script src="js/gaussianGenerator.js"></script>
    <script src="js/perturbation.js"></script>
    <script src="js/softAttributionPerturbation.js"></script>
    <script src="js/stimuli_gallery.js"></script>
</body>

</html>