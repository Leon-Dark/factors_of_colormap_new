<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Colormap Generator - Modular</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="../rainbows good or bad for/supplementary materials/experiment interface/lib/colorname/c3.js"></script>
</head>

<body>
    <div style="padding: 20px; background: #f5f5f5; border-bottom: 2px solid #4CAF50;">
        <h1 style="margin: 0 0 10px 0; color: #333;">Colormap Generator with Quality Metrics</h1>
        <button onclick="generateAll()"
            style="padding: 10px 20px; font-size: 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
            üé® Generate All Colormaps
        </button>
        <p style="color: #666; margin: 10px 0 0 0; font-size: 14px;">Click the button to generate colormaps with quality
            metrics. Open Console (F12) to see detailed logs.</p>

        <!-- Statistics Panel -->
        <div id="statisticsPanel"
            style="display: none; margin-top: 15px; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin: 0 0 10px 0; color: #333; font-size: 16px;">üìä Statistics</h3>
            <div style="border-bottom: 2px solid #e0e0e0; margin-bottom: 10px;"></div>

            <!-- Overall Statistics -->
            <div id="overallStats"
                style="font-size: 14px; margin-bottom: 15px; display: flex; gap: 20px; flex-wrap: wrap;">
                <div><strong>Total generated:</strong> <span id="totalCount">0</span></div>
                <div style="color: #4CAF50;"><strong>‚úÖ Pass both:</strong> <span id="passCount">0</span> (<span
                        id="passPercent">0</span>%)</div>
                <div style="color: #FF9800;"><strong>‚ö†Ô∏è Fail Cond 1:</strong> <span id="failCond1Count">0</span> (<span
                        id="failCond1Percent">0</span>%)</div>
                <div style="color: #9C27B0;"><strong>‚ö†Ô∏è Fail Cond 2:</strong> <span id="failCond2Count">0</span> (<span
                        id="failCond2Percent">0</span>%)</div>
                <div style="color: #f44336;"><strong>‚ùå Fail both:</strong> <span id="failBothCount">0</span> (<span
                        id="failBothPercent">0</span>%)</div>
            </div>

            <!-- Detailed Statistics -->
            <details style="margin-top: 10px;">
                <summary style="cursor: pointer; font-weight: bold; color: #666; padding: 5px 0;">Detailed breakdown ‚ñº
                </summary>
                <div id="detailedStats"
                    style="margin-top: 10px; padding: 10px; background: #f9f9f9; border-radius: 4px; font-size: 13px;">
                </div>
            </details>

            <!-- Sampling Mode Selection Panel -->
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                <div style="font-weight: bold; margin-bottom: 12px; color: #555;">üéØ Sampling Mode:</div>

                <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                    <label style="cursor: pointer; display: flex; align-items: center; gap: 5px;">
                        <input type="radio" name="samplingMode" value="jnd" onchange="switchSamplingMode()">
                        <span style="font-weight: 500;">JND-based Sampling</span>
                    </label>
                    <label style="cursor: pointer; display: flex; align-items: center; gap: 5px;">
                        <input type="radio" name="samplingMode" value="uniform" checked onchange="switchSamplingMode()">
                        <span style="font-weight: 500;">Uniform Sampling</span>
                    </label>
                </div>

                <!-- JND Mode Parameters -->
                <div id="jndModePanel" style="display: none;">
                    <div
                        style="margin-bottom: 12px; padding: 10px; background: #fff9e6; border-radius: 4px; border: 1px solid #ffe066;">
                        <div style="font-weight: 500; margin-bottom: 8px; color: #666;">üìä JND Step Size</div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="min-width: 120px; font-size: 13px;">JND step =</label>
                            <input type="range" id="jndStepSlider" min="0.5" max="10" step="0.1" value="3"
                                style="flex: 1; cursor: pointer;" oninput="updateJndStep(this.value)">
                            <input type="number" id="jndStepValue" min="0.5" max="10" step="0.1" value="3"
                                style="width: 60px; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 13px;"
                                oninput="updateJndStep(this.value)">
                        </div>
                    </div>

                    <div style="margin-bottom: 12px; padding: 10px; background: #f9f9f9; border-radius: 4px;">
                        <div style="font-weight: 500; margin-bottom: 8px; color: #666;">üìè Condition 1: JND Consistency
                            Check</div>
                        <div style="font-size: 11px; color: #666; font-style: italic;">
                            Min color diff between JND samples ‚â• JND step
                        </div>
                    </div>

                    <div style="padding: 10px; background: #f0f8ff; border-radius: 4px;">
                        <div style="font-weight: 500; margin-bottom: 8px; color: #666;">üìê Condition 2: Sample Interval
                            Check</div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <label style="min-width: 120px; font-size: 13px;">Interval k =</label>
                            <input type="range" id="intervalKSlider" min="1" max="20" step="1" value="5"
                                style="flex: 1; cursor: pointer;"
                                oninput="updateJndInterval(this.value, document.getElementById('intervalJValue').value)">
                            <input type="number" id="intervalKValue" min="1" max="20" step="1" value="5"
                                style="width: 60px; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 13px;"
                                oninput="updateJndInterval(this.value, document.getElementById('intervalJValue').value)">
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="min-width: 120px; font-size: 13px;">Min Diff j ‚â•</label>
                            <input type="range" id="intervalJSlider" min="0" max="50" step="0.5" value="10"
                                style="flex: 1; cursor: pointer;"
                                oninput="updateJndInterval(document.getElementById('intervalKValue').value, this.value)">
                            <input type="number" id="intervalJValue" min="0" max="50" step="0.5" value="10"
                                style="width: 60px; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 13px;"
                                oninput="updateJndInterval(document.getElementById('intervalKValue').value, this.value)">
                        </div>
                    </div>
                </div>

                <!-- Uniform Mode Parameters -->
                <div id="uniformModePanel" style="display: block;">
                    <div
                        style="margin-bottom: 12px; padding: 10px; background: #e8f5e9; border-radius: 4px; border: 1px solid #81c784;">
                        <div style="font-weight: 500; margin-bottom: 8px; color: #666;">üìä Sample Count</div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="min-width: 120px; font-size: 13px;">Sample count =</label>
                            <input type="range" id="uniformCountSlider" min="5" max="50" step="1" value="20"
                                style="flex: 1; cursor: pointer;" oninput="updateUniformCount(this.value)">
                            <input type="number" id="uniformCountValue" min="5" max="50" step="1" value="20"
                                style="width: 60px; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 13px;"
                                oninput="updateUniformCount(this.value)">
                        </div>
                    </div>

                    <div style="margin-bottom: 12px; padding: 10px; background: #f0f8ff; border-radius: 4px;">
                        <div style="font-weight: 500; margin-bottom: 8px; color: #666;">üìè Small Window Check</div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <label style="min-width: 120px; font-size: 13px;">Interval k ‚â•</label>
                            <input type="range" id="uniformSmallIntervalSlider" min="1" max="10" step="1" value="2"
                                style="flex: 1; cursor: pointer;"
                                oninput="updateUniformSmallWindow(this.value, document.getElementById('uniformSmallDiffValue').value)">
                            <input type="number" id="uniformSmallIntervalValue" min="1" max="10" step="1" value="2"
                                style="width: 60px; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 13px;"
                                oninput="updateUniformSmallWindow(this.value, document.getElementById('uniformSmallDiffValue').value)">
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="min-width: 120px; font-size: 13px;">Min diff ‚â•</label>
                            <input type="range" id="uniformSmallDiffSlider" min="0" max="50" step="0.5" value="3"
                                style="flex: 1; cursor: pointer;"
                                oninput="updateUniformSmallWindow(document.getElementById('uniformSmallIntervalValue').value, this.value)">
                            <input type="number" id="uniformSmallDiffValue" min="0" max="50" step="0.5" value="3"
                                style="width: 60px; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 13px;"
                                oninput="updateUniformSmallWindow(document.getElementById('uniformSmallIntervalValue').value, this.value)">
                        </div>
                    </div>

                    <div style="padding: 10px; background: #fff8e1; border-radius: 4px;">
                        <div style="font-weight: 500; margin-bottom: 8px; color: #666;">üìê Large Window Check</div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <label style="min-width: 120px; font-size: 13px;">Interval k ‚â•</label>
                            <input type="range" id="uniformLargeIntervalSlider" min="1" max="20" step="1" value="5"
                                style="flex: 1; cursor: pointer;"
                                oninput="updateUniformLargeWindow(this.value, document.getElementById('uniformLargeDiffValue').value)">
                            <input type="number" id="uniformLargeIntervalValue" min="1" max="20" step="1" value="5"
                                style="width: 60px; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 13px;"
                                oninput="updateUniformLargeWindow(this.value, document.getElementById('uniformLargeDiffValue').value)">
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="min-width: 120px; font-size: 13px;">Min diff ‚â•</label>
                            <input type="range" id="uniformLargeDiffSlider" min="0" max="50" step="0.5" value="10"
                                style="flex: 1; cursor: pointer;"
                                oninput="updateUniformLargeWindow(document.getElementById('uniformLargeIntervalValue').value, this.value)">
                            <input type="number" id="uniformLargeDiffValue" min="0" max="50" step="0.5" value="10"
                                style="width: 60px; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 13px;"
                                oninput="updateUniformLargeWindow(document.getElementById('uniformLargeIntervalValue').value, this.value)">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter Controls -->
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                <div style="font-weight: bold; margin-bottom: 8px; color: #555;">üîç Display mode:</div>

                <!-- JND Mode Filters -->
                <div id="jndFilterOptions" style="display: none; gap: 15px; flex-wrap: wrap;">
                    <label style="cursor: pointer;">
                        <input type="radio" name="filterMode" value="all" checked onchange="applyFilter()">
                        Show all (<span id="filterAllCount">0</span>)
                    </label>
                    <label style="cursor: pointer; color: #4CAF50;">
                        <input type="radio" name="filterMode" value="pass" onchange="applyFilter()">
                        ‚úÖ Pass both (<span id="filterPassCount">0</span>)
                    </label>
                    <label style="cursor: pointer; color: #FF9800;">
                        <input type="radio" name="filterMode" value="failCond1" onchange="applyFilter()">
                        ‚ö†Ô∏è Fail Cond 1 (<span id="filterFailCond1Count">0</span>)
                    </label>
                    <label style="cursor: pointer; color: #9C27B0;">
                        <input type="radio" name="filterMode" value="failCond2" onchange="applyFilter()">
                        ‚ö†Ô∏è Fail Cond 2 (<span id="filterFailCond2Count">0</span>)
                    </label>
                    <label style="cursor: pointer; color: #f44336;">
                        <input type="radio" name="filterMode" value="failBoth" onchange="applyFilter()">
                        ‚ùå Fail both (<span id="filterFailBothCount">0</span>)
                    </label>
                </div>

                <!-- Uniform Mode Filters -->
                <div id="uniformFilterOptions" style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <label style="cursor: pointer;">
                        <input type="radio" name="filterModeUniform" value="all" checked onchange="applyFilter()">
                        Show all (<span id="filterAllCountUniform">0</span>)
                    </label>
                    <label style="cursor: pointer; color: #4CAF50;">
                        <input type="radio" name="filterModeUniform" value="pass" onchange="applyFilter()">
                        ‚úÖ Pass both (<span id="filterPassCountUniform">0</span>)
                    </label>
                    <label style="cursor: pointer; color: #FF9800;">
                        <input type="radio" name="filterModeUniform" value="failSmall" onchange="applyFilter()">
                        ‚ö†Ô∏è Fail Small (<span id="filterFailSmallCountUniform">0</span>)
                    </label>
                    <label style="cursor: pointer; color: #9C27B0;">
                        <input type="radio" name="filterModeUniform" value="failLarge" onchange="applyFilter()">
                        ‚ö†Ô∏è Fail Large (<span id="filterFailLargeCountUniform">0</span>)
                    </label>
                    <label style="cursor: pointer; color: #f44336;">
                        <input type="radio" name="filterModeUniform" value="failBoth" onchange="applyFilter()">
                        ‚ùå Fail both (<span id="filterFailBothCountUniform">0</span>)
                    </label>
                </div>
            </div>

            <!-- Retry Controls -->
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                <div style="font-weight: bold; margin-bottom: 8px; color: #555;">üîÑ Retry Failed Colormaps:</div>

                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-size: 13px; min-width: 100px;">Iterations:</label>
                        <input type="range" id="retryIterationsSlider" min="1" max="10" step="1" value="3"
                            style="width: 100px; cursor: pointer;" oninput="updateRetryIterations(this.value)">
                        <input type="number" id="retryIterationsValue" min="1" max="10" step="1" value="3"
                            style="width: 50px; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 13px;"
                            oninput="updateRetryIterations(this.value)">
                    </div>

                    <button onclick="retryFailed()"
                        style="padding: 8px 16px; font-size: 14px; background: #FF9800; color: white; border: none; border-radius: 4px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                        üîÑ Retry Failed
                    </button>
                </div>

                <div id="retryProgress" style="display: none; margin-top: 10px; font-size: 13px;"></div>
                <div id="retryResults" style="margin-top: 5px;"></div>
            </div>
        </div>
    </div>

    <!-- Retry Dashboard Overlay -->
    <div id="retryDashboard"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f0f0f0; z-index: 1000; overflow-y: auto;">

        <!-- Dashboard Header -->
        <div
            style="position: sticky; top: 0; background: white; padding: 15px 30px; border-bottom: 2px solid #ddd; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 1010;">
            <div>
                <h2 style="margin: 0; color: #333;">üîÑ Retry Dashboard</h2>
                <div id="retryStatusText" style="color: #666; font-size: 14px; margin-top: 5px;">Ready to retry failed
                    colormaps...</div>
            </div>

            <div style="display: flex; gap: 15px;">
                <button id="startRetryBtn" onclick="executeRetryFromDashboard()"
                    style="padding: 10px 20px; font-size: 16px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                    ‚ñ∂Ô∏è Start Retry
                </button>
                <button onclick="closeRetryDashboard()"
                    style="padding: 10px 20px; font-size: 16px; background: #757575; color: white; border: none; border-radius: 4px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                    ‚ùå Close
                </button>
            </div>
        </div>

        <!-- Comparison Content -->
        <div style="padding: 30px; max-width: 1400px; margin: 0 auto;">

            <!-- Headers for Columns -->
            <div
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 15px; font-weight: bold; color: #555; text-transform: uppercase; letter-spacing: 1px;">
                <div style="padding-left: 10px; border-left: 4px solid #f44336;">Before: Original Failed</div>
                <div style="padding-left: 10px; border-left: 4px solid #4CAF50;">After: Optimized Result</div>
            </div>

            <div id="retryComparisonContainer" style="display: flex; flex-direction: column; gap: 20px;">
                <!-- Rows will be injected here via JS -->
            </div>

        </div>
    </div>
    <div id="colormapsGrid"
        style="padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 20px;">
    </div>

    <!-- Load JavaScript Modules in Order -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/samplingModes.js"></script>
    <script src="js/metrics.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/filters.js"></script>
    <script src="js/uiControls.js"></script>
    <script src="js/colorGeneration.js"></script>
    <script src="js/visualization.js"></script>
    <script src="js/retry.js"></script>
    <script src="js/main.js"></script>
</body>

</html>